<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Input Anggota â€” FastAPI</title>
  <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>ğŸ§¾ Input Anggota</h1>

    <!-- ğŸ  Tombol Kembali ke Dashboard (sama seperti di /list) -->
    <div style="margin-bottom:15px;">
      <a href="/dashboard"><button class="home-btn">ğŸ  Kembali ke Dashboard</button></a>
    </div>

    <!-- ğŸ’¾ Unduh CSV -->
    <div style="text-align: right; margin: 10px 0;">
      <a href="/download_csv"><button class="download-csv">ğŸ’¾ Unduh CSV</button></a>
    </div>

    <!-- ğŸ§¾ Form Input Anggota -->
    <form action="/add" method="post" class="add-form">
      <input name="content" type="text" placeholder="Input NIK anggota" required />
      <button type="submit">Tambah</button>
    </form>

    <!-- ğŸ“‹ Daftar Anggota -->
    <div id="notes" class="notes">
      {% for note in notes %}
      <div class="note" data-note-id="{{ note.id }}">
        <p>{{ note.content }}</p>
        <small style="color: gray; font-size: 0.8em;">ğŸ•’ {{ note.created_local }}</small>

        <div class="actions">
          <form action="/delete/{{ note.id }}" method="post" style="display:inline;">
            <button type="submit" class="delete">âŒ</button>
          </form>
          <button type="button" class="edit" data-content="{{ note.content | e }}"
            onclick="showEditForm({{ note.id }}, this.dataset.content)">âœï¸</button>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- âœï¸ Edit Form -->
    <div id="editForm" class="edit-form" style="display:none;">
      <h3>Edit NIK Anggota</h3>
      <form id="editFormInner" method="post">
        <input type="hidden" id="editId" name="id" />
        <input type="text" id="editContent" name="content" required />
        <div style="margin-top:10px;">
          <button type="submit">Simpan</button>
          <button type="button" id="cancelEditBtn">Batal</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Fungsi tampilkan form edit
    function showEditForm(id, content) {
      document.getElementById("editForm").style.display = "block";
      document.getElementById("editId").value = id;
      document.getElementById("editContent").value = content;
    }

    // Submit form edit via fetch
    document.getElementById("editFormInner").onsubmit = function (e) {
      e.preventDefault();
      let id = document.getElementById("editId").value;
      let content = document.getElementById("editContent").value;
      fetch(`/edit/${id}`, {
        method: "POST",
        body: new URLSearchParams({ content })
      }).then(() => window.location.reload());
    };

    // Tombol batal edit
    document.getElementById("cancelEditBtn").addEventListener("click", () => {
      document.getElementById("editForm").style.display = "none";
    });

    // ğŸ” Pencarian langsung
    const searchInput = document.getElementById("searchInput");
    if (searchInput) {
      searchInput.addEventListener("input", () => {
        const q = searchInput.value.toLowerCase();
        document.querySelectorAll(".note").forEach(noteEl => {
          const text = noteEl.querySelector("p").textContent.toLowerCase();
          noteEl.style.display = text.includes(q) ? "flex" : "none";
        });
      });
    }

    // ğŸŒ™ Tema gelap
    const toggleBtn = document.getElementById("toggleTheme");
    if (toggleBtn) {
      const current = localStorage.getItem("theme");
      if (current === "dark") document.body.classList.add("dark"), toggleBtn.textContent = "â˜€ï¸";
      toggleBtn.addEventListener("click", () => {
        const isDark = document.body.classList.toggle("dark");
        toggleBtn.textContent = isDark ? "â˜€ï¸" : "ğŸŒ™";
        localStorage.setItem("theme", isDark ? "dark" : "light");
      });
    }
  </script>
</body>
</html>
